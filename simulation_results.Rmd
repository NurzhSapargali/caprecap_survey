---
title: "Comparison with other estimators in simulation"
output:
  pdf_document: default
  html_document:
    df_print: paged
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

A simulation study is conducted to assess the performance of our estimator in 
comparison to the existing methods in the literature. I differentiate between 
four cases: equal inclusion probabilities with equal sample sizes, equal 
inclusion probabilities with different sample sizes, unequal probabilities with 
equal sample sizes and unequal probabilities with different sample size.

For each case, the simulation is conducted as follows. First, the true population
size $N$ is fixed along with the $\alpha$ parameter. Then, $p_i$ are generated 
for each individual $i = 1, \dots, N$ by drawing $N$ values from $Beta(\alpha, \alpha(N - 1))$. 
For cases with different sample sizes, a set of $T$ sample sizes $\{n_1, \dots, n_T\}$ 
is generated randomly, while for cases with equal sample sizes $n_1 = n_2 = ... = n_T = n$ 
for some fixed $n$. Finally, $T$ samples are generated by drawing $n_t$ times from 
population without replacement in accordance with inclusion probabilities 
$\pi_{it} = n_t \cdot pi_i$ for each $t = 1, \dots, T$ and $i = 1, \dots, N$.

Given the simulated samples, the estimates of the population size are computed. 
The above procedure is repeated 100 times for each case and the resulting population 
size estimates are illustrated in a boxplot for comparison with other approaches.

Since the loglikelihood function involves integrals without analytical solutions, 
the optimization is performed numerically. The integrals are approximated by 
Monte Carlo integration, as we can easily produce draws from the beta distribution. 
Another advantage of solving the integrals by Monte Carlo integration, as opposed 
to other deterministic numerical integration methods, is that there is no need 
to evaluate beta functions, thus avoiding numerical overflow. For each loglikelihood 
evaluation, the Monte Carlo integration is performed with 1000 draws for each 
integral term.

The loglikelihood is fitted using Rowan (1990)'s Subplex optimization algorithm, which 
is a more robust and efficient variant of Nelder-Mead Simplex method. 



\section{Equal probabilities}
For equal inclusion probabilities, $\alpha \to \infty$ and $T$ samples are drawn 
via simple random sampling without replacement. For the next two cases, the 
population size is set to $N = 1000$ with $T \in \{2, 4, 10\}$. For $T = 2$, only 
simulations with recaptures are considered.

\subsection{Equal sample sizes}
For this case, the sample sizes were fixed at $n_1 = ... = n_T = 30$.

The boxplots below describe the distribution of estimates for various values of 
$T$ for different estimators. To control for variability of estimates, a reciprocal 
was taken. The blue vertical line represents true value at $1 / N = 0.001$.

![](./_900_output/figures/eqp_eqn/estimates_boxplots.pdf)

Additionally, similar boxplots were produced separately comparing our estimator 
with the jackknife capture-recapture estimator for different values of the 
jackknife's hyperparameter $k$.

![](./_900_output/figures/eqp_eqn/jks_boxplots.pdf)

The boxplots of estimates of the $\alpha$ parameter are also given below. As the 
true $\alpha$ is infinity in this case, the estimated values are accordingly large 
and so the x-axis is given in log scale.

![](./_900_output/figures/eqp_eqn/alpha_hat.pdf)

\subsection{Unequal sample sizes}
For the case of equal inclusion probabilities with different sample sizes, the 
simulation was conducted with the same parameters as previously but with sample 
sizes generated from $n_t \sim Poisson(30)$ for all $t = 1, \dots, T$, producing 
the same set of figures.

![](./_900_output/figures/eqp_eqn/estimates_boxplots.pdf)

![](./_900_output/figures/eqp_eqn/jks_boxplots.pdf)

![](./_900_output/figures/eqp_eqn/alpha_hat.pdf)

\section{Unequal probabilities}
The simulation of unequal probability sampling is performed with the Sampford 
algorithm. Recall that parameter $\alpha$ determines the heterogeneity of inclusion 
probabilities across population. For $\alpha \to \infty$, all population units 
have the same inclusion probability. Conversely, smaller values of $\alpha$ 
correspond to populations with highly heterogeneous inclusion probabilities. 
For this reason, the simulation is performed for different values of $\alpha$, 
namely $\alpha \in \{0.1, 3, 10\}$.

To get a better sense of accuracy of estimators with increasing data, the 
sample draws are changed to $T \in \{2, 5, 10, 15, 20\}$.

\subsection{Equal sample sizes}
Unlike the case of equal probability sampling where $\pi_{it} = 1 / N$, in 
unequal probability sampling,  the assumption $\pi_{it} = n_t \cdot p_i$ must be 
ensured, which translates to enforcing $0 \leq \pi_{it} \leq 1$. For fixed 
$n_1 = ... = n_T = n$ and $\alpha \in \{0.1, 3, 10\}$, the population size $N$ 
must be chosen appropriately.

Using model assumptions,

$$
\text{pr}(\pi_{it} \leq 1) = \text{pr}(np_i \leq 1) = \text{pr}(p_i \leq 1 / n)
= I_{1/n}(\alpha, \alpha(N - 1))
$$
where $I_{x}(\alpha, \beta)$ is the regularized incomplete beta function.

Following assumption of independence of inclusion probabilities,

$$
\text{pr}(p_i \leq 1 / n \ \forall i = 1, \dots, N) = \prod_{i=1}^N I_{1/n}(\alpha, \alpha(N - 1)) 
= [I_{1/n}(\alpha, \alpha(N - 1))]^N
$$
Thus, for fixed $\alpha$ and $n$, the population size $N$ must be chosen such 
that $\text{pr}(p_i \leq 1 / n \ \forall i = 1, \dots, N)$ is high enough. For 
this case, I set $n = 30, N = 3000$, therefore

$$
\text{pr}(p_i \leq 1 / 30 \ \forall i = 1, \dots, 3000) \approx 1.0 \quad \forall \alpha \in \{0.1, 3, 20\} 
$$

\subsubsection{$\alpha = 0.1$}

![](./_900_output/figures/diffp_eqn/estimates_boxplots_0.1.pdf)

![](./_900_output/figures/diffp_eqn/jks_boxplots_0.1.pdf)

![](./_900_output/figures/diffp_eqn/alpha_hat_0.1.pdf)

Finally, for reference, the plots below show the loglikelihood function for 
different values of each parameter while fixing the other at the true value for 
each $T$ and simulation replication.

![](./_900_output/figures/diffp_eqn/alpha_trace_2_0.1.pdf)

![](./_900_output/figures/diffp_eqn/alpha_trace_5_0.1.pdf)

![](./_900_output/figures/diffp_eqn/alpha_trace_10_0.1.pdf)
![](./_900_output/figures/diffp_eqn/alpha_trace_15_0.1.pdf)
![](./_900_output/figures/diffp_eqn/alpha_trace_20_0.1.pdf)

![](./_900_output/figures/diffp_eqn/Nu_trace_2_0.1.pdf)

![](./_900_output/figures/diffp_eqn/Nu_trace_5_0.1.pdf)

![](./_900_output/figures/diffp_eqn/Nu_trace_10_0.1.pdf)
![](./_900_output/figures/diffp_eqn/Nu_trace_15_0.1.pdf)
![](./_900_output/figures/diffp_eqn/Nu_trace_20_0.1.pdf)

\newpage

\subsubsection{$\alpha = 3$}

![](./_900_output/figures/diffp_eqn/estimates_boxplots_3.0.pdf)

![](./_900_output/figures/diffp_eqn/jks_boxplots_3.0.pdf)

![](./_900_output/figures/diffp_eqn/alpha_hat_3.0.pdf)

![](./_900_output/figures/diffp_eqn/alpha_trace_2_3.0.pdf)

![](./_900_output/figures/diffp_eqn/alpha_trace_5_3.0.pdf)

![](./_900_output/figures/diffp_eqn/alpha_trace_10_3.0.pdf)

![](./_900_output/figures/diffp_eqn/alpha_trace_15_3.0.pdf)

![](./_900_output/figures/diffp_eqn/alpha_trace_20_3.0.pdf)

![](./_900_output/figures/diffp_eqn/Nu_trace_2_3.0.pdf)

![](./_900_output/figures/diffp_eqn/Nu_trace_5_3.0.pdf)

![](./_900_output/figures/diffp_eqn/Nu_trace_10_3.0.pdf)

![](./_900_output/figures/diffp_eqn/Nu_trace_15_3.0.pdf)

![](./_900_output/figures/diffp_eqn/Nu_trace_20_3.0.pdf)

\newpage

\subsubsection{$\alpha = 10$}

![](./_900_output/figures/diffp_eqn/estimates_boxplots_10.0.pdf)

![](./_900_output/figures/diffp_eqn/jks_boxplots_10.0.pdf)

![](./_900_output/figures/diffp_eqn/alpha_hat_10.0.pdf)

![](./_900_output/figures/diffp_eqn/alpha_trace_2_0.1.pdf)

![](./_900_output/figures/diffp_eqn/alpha_trace_5_10.0.pdf)

![](./_900_output/figures/diffp_eqn/alpha_trace_10_10.0.pdf)

![](./_900_output/figures/diffp_eqn/alpha_trace_15_10.0.pdf)

![](./_900_output/figures/diffp_eqn/alpha_trace_20_10.0.pdf)

![](./_900_output/figures/diffp_eqn/Nu_trace_2_10.0.pdf)

![](./_900_output/figures/diffp_eqn/Nu_trace_5_10.0.pdf)

![](./_900_output/figures/diffp_eqn/Nu_trace_10_10.0.pdf)

![](./_900_output/figures/diffp_eqn/Nu_trace_15_10.0.pdf)

![](./_900_output/figures/diffp_eqn/Nu_trace_20_10.0.pdf)

## References
T. Rowan, "Functional Stability Analysis of Numerical Algorithms", Ph.D. thesis, 
Department of Computer Sciences, University of Texas at Austin, 1990.
